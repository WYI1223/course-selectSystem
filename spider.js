const cheerio = require('cheerio2')
const fs = require('fs')
const path = require('path')
// const superagent = require('superagent');
// const url = `https://selfservice.kean.edu/Student/Courses/SearchAsync`

var option = {
  method: 'POST',
  headers: {
    'Request url': 'https://selfservice.kean.edu/Student/Courses/SearchAsync',
    'Accept': 'application/json, text/javascript, */*; q=0.01',
    'Accept-Encoding': ' gzip, deflate, br',
    'Accept-Language': 'zh-CN,zh;q=0.9',
    'Connection': 'keep-alive',
    'Content-Length': '839',
    'Content-Type': 'application/json, charset=UTF-8',
    'Cookie': '_fbp=fb.1.1661744578012.1993831860; _gcl_au=1.1.1463677335.1662641135; __RequestVerificationToken_L1N0dWRlbnQ1=MzOmE4qwxUvU982NC2ia7XZzMNgwAvwYL0LN1Ov_cX3VtiPmulgL8ajielQDcSs8Tibh8U-bXZlUgQL2TDQss7zb24DrkHXIor6J_TwAHZ41; _gid=GA1.2.1042426271.1669460129; studentselfservice_production_sfid=L68C42D06F28; studentselfservice_production_AuthMethod=Forms; studentselfservice_production_0=EF288B6426E56909DEEBDF8DF8B6BA37D68655B3C3D3EFC4EDC3709352CFA3ED9E0A71F6C11C3F65BD0EEC2C6AC10C01B95CFD22888F3AF96DD930206C4FA67D4BA121194B02A95860783CA282F973BEA3209D7BE233D2B827594CD68E22C31716DD34A20C4096FD53477F95C09466A9F3CF8AFDBE282740DB4EEC97FB3C74E668232C1C749D5C92DD9EC203F9905033273389F2ADE4F892BC0BAAEB3446BC45AC330C1FAA17F45B61053604A9C36239DD41D2A278FA0EB9BB101AB63AE85AAA83C1F9CB40264ACCEE13C70DDE008D495E400A428992E2BB41384E30178626C9A52F009DDCE21D2FD75A87E29BE293EE2C260ED9C4E98B49FF776DCF4D3439C65D7EFB94F1EA7FA77EA4FF84BA530BB54BE657B88CB6487B3488B73D6ECDBDAF72ABA4BB1049B4AEA012243C71B1ECE98EB67F95F81E17A59330D512A67F4B75E70D8A50A0CAA6C6F8045AC97E985FA1788C942582F01131E021232BF127C973F5674E8DF680E4F023A672071D0449FB96A9564D7E2B00AB943C89E6A67B329DA7611B9DC338053FE02CAA58EAE7A4111017D27FE13F599F2BEA4C87F4002A5DBAA1C8958339E4DF50F24447DDB82C12E8B5E7F94CBABF2827A1348D8E859DD144F6CFE3F7B9F1AE841E2936BDE317332422C95185C225914A7057F70573875E1E8E522527C561EEF3C4271C135339F61A95E2F09CE9AE475583F48C4150D085C4A1343549DBC7C23C66DE56023128CABF87D2C4B707839CC5CE8B48B83F3AB196DEBF6ADBE98EE168FA69F2806D9599B478C63F642A95B0B2CB376AACB3C70D1D904C1938FD56BEA31799030AB6E67DE2D5C492492A836DC689DAF6B7AF7E62B44E2343079FD6F5EE62AEFFF9985045BF612CCD12436B0BDBA254CA200F489DB638F22FB297789FE40DB644D4E67155329880C7CCD771441F6EC86DD219BC91385FE089FF40CFB817643F271A40A12B600079C3581019F683F57C2325CB2D2CB6E5191D9DD36D476563ECC85525ADB29AF5E4990B91534236FCA3333A407AF966716B26CA861C8E855E916474DFCFA102038D84C98FAC67B0BF7B9F9FE57CDBC0AD08250DF02A4BDD5276C9AF78B5EA63DF25E96A2D83E4F281CF47E1A968FC394B599F2BA8DC2EE39E75831493CFE5BAA000C30ED9633D22DEB81F7930E19C; _ga_HN53Y9FJJ9=GS1.1.1669462762.14.0.1669462762.0.0.0; BE_CLA3=p_id%3D2P2P68RR66N4R2P6LNN2JP8NAAAAAAAAAH%26bf%3Df6cbdb20e4bdace6af13d8d457db2586%26bn%3D1%26bv%3D3.44%26s_expire%3D1669549164378%26s_id%3D2P2P68RR66N4R84J2A42JP8NAAAAAAAAAH; _ga=GA1.2.552367636.1654411248',
    'Host': 'selfservice.kean.edu',
    'Origin': 'https://selfservice.kean.edu',
    'Referer': 'https://selfservice.kean.edu/Student/Courses/Search',
    'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36',
    'Accept': 'image/webp,image/apng,image/*,*/*;q=0.8',
    'Cache-Control': 'no-cache',
    'Accept-Charset': 'GB2312,utf-8;q=0.7,*;q=0.7',
  }
};
var html=[];
var len = 0;
var req=http.request(option,function(res){
res.on('data',function(data){
    html.push(data);// data里面的数据就是网页的内容
    len += data.length;
});
res.on('end',function(){
    var dataAll = Buffer.concat(html,len);
    var strJson = iconv.decode(dataAll,'gb2312');
    //解决乱码问题
    var the_course = filterCourse(strJson);//解析网页（函数）
})
});
req.on('error',function(e){
console.log('Error:'+e.message)
});
req.end();

